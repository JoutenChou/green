function webATMPluginDetect(t){var n="41";switch(navigator.appName){case"Microsoft Internet Explorer":n="11"}"11"===n?jQuery(document.body).append('<object id="Xcsp" classid="clsid:A6132015-5796-48B5-B776-16D009021D81"></object>'):jQuery(document.body).append(jQuery("<embed/>",{id:"Xcsp",width:"0",height:"0",classid:"clsid:A6132015-5796-48B5-B776-16D009021D81",type:"application/FCB-WebATM-plugin"}));document.getElementById("Xcsp");try{Xcsp.DisconnectCard(),Xcsp.DisconnectDriver()}catch(a){t("https://eatm.firstbank.com.tw/lio1000s8")}}$(document).ready(function(){$.topnav.init(),$.getCounter(),$.showMsgBox()}),function(t){function n(){"zh-TW"===Body.attr("lang")&&t.topnav.guestTool(),t.topnav.langToggle()}function a(){t.topnav.ajax({url:"/account/tools/",dataType:"html",data:t.param({t:"t",f:"s_guesttools"})}).done(function(n){t("#topnav").append(n),t("#topnav").on("click","#login-btn",function(n){return t.NDCLogin.setVirtualHost(t(this).attr("href")),t.util.addScript("validate","/templates/js/libs/jquery-validation/dist/jquery.validate.min.js",e),!1}),t.topnav.cart.init(),t("#manager-login-js").length&&t.util.addWindowOnLoad(function(){t.topnav.addManagerLogin()})})}function e(){t("#modal-login").length?t("#modal-login").NDCLogin():t.tplLoader.load("login.html",function(n){n=n.format(t("#logo").html(),t("#logo").text()),t(n).appendTo("body").NDCLogin()})}var o=function(){function n(t){"undefined"==typeof t?0===parseInt(r.text())?r.hide():r.show():0===parseInt(t)?r.hide():r.text(t).show()}function a(){t.ajax({type:"POST",url:"/shopping/mycart/",dataType:"json",async:!1,success:function(t){e(t)}})}function e(a){var e=t("#dropdown-checkout"),o=e.find(".totalprice"),r=e.children(".start-checkout"),c='<tr class="text-center"><td>目前沒有購買產品</td></tr>',s='<tr>                <th><a href="/{0}">{1}</a></th>                <td>{2}</td>                <td> &times;{3}</td>                <td class="price">{4}</td>                <td class="text-right"><a class="trash-btn" id="{5}" title="從購物車中移除本商品" data-toggle="tooltip" data-container="body"></a></td>                </tr>',l='<a href="https://{0}/shopping/cart/" class="start-checkout btn btn-block btn-cart"><i class="fa fa-shopping-cart fa-lg"></i>開始結帳</a>';a.num>0?(i.html(""),t.each(a.item,function(n,a){var e=a.price*a.quantity;t(s.format(a.filename,a.name,a.spec,a.quantity,e,a.id)).appendTo(i)}),r.length||e.append(l.format(window.location.host)),o.text(a.subtotal),n(a.num)):(i.html(c),r.length&&r.remove(),o.text("0"),n(0))}function o(n){var e={t:"t",f:"d_delitems",f_d_invid:n.attr("id")};t.ajax({type:"POST",url:window.location.pathname,dataType:"json",data:t.param(e),success:function(n){"success"==n.state?(a(),t.productSpec.refreshModels()):e7notice(n.error,"error")}})}var i,r;return{init:function(){i=t("#check-table"),r=t("#cart-badge"),i.on("click",".trash-btn",function(){return t(this).tooltip("destroy"),o(t(this)),!1}),t.util.addWindowOnLoad(function(){0!==parseInt(r.text())&&t(".cart .dropdown-toggle").dropdown("toggle")}),n(),a()}}}();t.extend(t.topnav,{init:n,guestTool:a,openLogin:e,cart:o})}(jQuery),function(t){t.getCounter=function(){var n={t:"t",f:"d_counter"};t.ajax({type:"POST",url:window.location.pathname,dataType:"json",data:t.param(n),async:!1,success:function(n){t("#counter span").html(n.visitors)}})}}(jQuery),function(t){t.fn.payway=function(){function n(n){e.button("loading");var a={t:"t",f:"s_getPayment",f_s_custno:o.data("custno"),f_s_payment:n};t.ajax({type:"POST",url:"/shopping/payment/",dataType:"json",data:t.param(a),async:!1,success:function(n){"success"==n.status?(e.button("complete"),o.attr("action",n.payment.paypage),i.empty(),t.each(n.payment.parames,function(n,a){t("<input/>").attr({type:"hidden",name:n,value:a}).appendTo(i)})):alert(n.message)},timeout:1e4})}var a,e=this.find(".btn-cart"),o=this.find("form"),i=this.find(".hidden");this.find(".form-overseas-payway").length?(n(o.find("input[name='f_s_payment']").val()),o.find("input[name='f_s_payment']").remove()):(this.children().on("change","input[name='f_s_payment']",function(e){if(n(t(this).val()),"4"===t(this).val()){var i=o.parent(".form-payway");a=i.prev(".alert"),webATMPluginDetect(function(n){a.length||(a=t("<div/>",{"class":"alert alert-warning fade in",role:"alert"}).insertBefore(i)),a.html('<i class="fa fa-exclamation-triangle"></i>                            你尚未安裝由第一銀行提供的 WebATM 晶片金融卡安控元件，請您先執行 <a href="{0}" target="_blank" class="alert-link">安裝晶片金融卡安控元件</a>                            <br>※ 本WebATM尚不支援Firefox、Chrome瀏覽器'.format(n,"https://eatm.firstbank.com.tw/lio1000s1?CtlSeqNo=20&naLoginSource=&naPushBranchId=")).alert()})}else"undefined"!=typeof a&&a.alert("close")}),o.submit(function(){return 0===o.find("input[name='f_s_payment']:checked").length?(alert("請選擇付款方式"),!1):void o.find("input[name='f_s_payment']").remove()}))}}(jQuery),function(t){function n(n){t.data(n,"elem",{blockLogin:t(n).find(".block-login"),blockForgot:t(n).find(".block-forgot"),subblockLogin:t(n).find(".subblock-login"),subblockSignup:t(n).find(".subblock-signup"),forgetBtn:t(n).find(".link-forgot"),cancelBtn:t(n).find(".cancel"),linkSignupBtn:t(n).find(".link-signup"),backLoginBtn:t(n).find(".back-login"),inputAccount:t(n).find('input[name="account"]'),inputPasswd:t(n).find('input[name="passwd"]'),inputCaptcha:t(n).find('input[name="captcha"]'),form:t(n).find("form"),isForgot:!1,isSignup:!1});var i=t.data(n,"elem");i.form.attr("action",o+a.login+e),i.forgetBtn.bind("click",function(){i.isForgot=!0,i.form.attr("action",o+a.forgot+e),i.blockLogin.slideUp("fast"),i.blockForgot.slideDown("fast")}),i.cancelBtn.bind("click",function(){i.isForgot=!1,i.form.attr("action",o+a.login+e),i.blockLogin.slideDown("fast"),i.blockForgot.slideUp("fast")}),i.linkSignupBtn.bind("click",function(){i.isSignup=!0,i.form.attr("action",o+a.singup+e),i.subblockLogin.slideUp("fast"),i.subblockSignup.slideDown("fast")}),i.backLoginBtn.bind("click",function(){i.isSignup=!1,i.form.attr("action",o+a.login+e),i.subblockLogin.slideDown("fast"),i.subblockSignup.slideUp("fast")}),i.form.validate({rules:{account:{required:!0,email:!0},passwd:{minlength:6,required:function(){return!i.isForgot}},captcha:{required:function(){return i.isForgot}},passwdagain:{required:function(){return i.isSignup},equalTo:"#passwd"},agree:{required:function(){return i.isSignup}}},messages:{account:{required:"請輸入 email",email:"請輸入正確的 email 格式"},passwd:{minlength:"請輸入6個以上的英數字元",required:"請輸入密碼"},captcha:{required:"請輸入驗證碼"},passwdagain:{required:"請再次輸入密碼",equalTo:"您再次輸入的密碼不相符"},agree:{required:"您必須同意服務條款"}},highlight:function(n,a,e){t(n).parents(".form-group").addClass("has-error")},unhighlight:function(n,a,e){t(n).parents(".form-group").removeClass("has-error"),t(n).next(".help-block").remove()},errorClass:"error",errorPlacement:function(n,a){var e=t(a).parents(".form-group").children(".help-block");e.length||(e=t("<p/>",{"class":"help-block"}).appendTo(a.parents(".form-group"))),e.text(n.text())},submitHandler:function(n){t(n).find('button[type="submit"]').button("loading"),n.submit()}})}var a={login:"/account/login/auth/",forgot:"/account/forget/",singup:"/account/singup/"},e="",o="",i="";t.NDCLogin={setVirtualHost:function(t){var n=/(https?\:\/\/|\/\/)?[^\/\s]+\.iyp\.tw/i;n.test(t)&&(o=n.exec(t)[0]||"")},setValiCode:function(t){i="&code="+t}},t.fn.NDCLogin=function(){var a={};Body.hasClass("login")&&(a={keyboard:!0,backdrop:"static"}),this.modal(a),e="/account/login/"!==window.location.pathname?"?redirect="+o+window.location.pathname+i:"?redirect=/account/order/","undefined"==typeof t.data(this[0],"elem")&&n(this[0])}}(jQuery);